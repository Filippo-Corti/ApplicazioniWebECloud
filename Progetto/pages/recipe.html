<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PGRC | </title>
  <link rel="icon" href="../assets/img/favicon.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="../assets/css/my-colors.css">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body class="overflow-x-hidden" data-font="fancy">

  <!-- Background Stripes -->
  <div class="background-stripe">
  </div>

  <!-- Background Grid-->
  <div class="background-grid">
    <div class="d-none background-grid-col"></div>
    <div class="d-none background-grid-row"></div>
  </div>

  <!-- Header -->
  <header>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg" aria-label="Offcanvas navbar large">
      <div class="container-xxl pt-4 pt-md-5 px-3">
        <!-- Logo -->
        <div>
          <a class="logo | d-flex align-items-baseline gap-1" href="../index.html">
            <img class="tint-primary" src="../assets/img/chef.png" alt="PGRC Logo">
            <h1 class="h-0 text-primary">PGRC</h1>
          </a>
        </div>
        <!-- Mobile Menu Button-->
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
          <div class="offcanvas-header justify-content-end px-5 mt-3 pb-0">
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body justify-content-end">
            <ul class="navbar-nav align-items-center gap-2">
              <li class="nav-item logged-out-only">
                <h5 class="text-center border-top border-bottom py-4 d-lg-none">
                  SIGN UP for more functionalities!
                </h5>
              </li>
              <li class="nav-item logged-out-only">
                <a href="../pages/signup.html">
                  <button class="btn btn-outline-secondary fs-4">
                    SIGN UP
                  </button>
                </a>
              </li>
              <li class="nav-item logged-out-only">
                <button class="btn btn-primary fs-4" data-bs-toggle="modal" data-bs-target="#loginModal">
                  LOG IN
                </button>
              </li>
              <li class="nav-item logged-in-only">
                <a href="../pages/profile.html">
                  <button class="btn btn-outline-secondary fs-4 d-flex align-items-center gap-2 py-2">
                    <!-- Username & Picture -->
                    <p class="username card-text bg-transparent mb-0">Username</p>
                    <div class="bg-primary rounded-5" style="width:fit-content">
                      <img src="../assets/img/anon.png" alt="Profile Picture">
                    </div>
                  </button>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Recipe -->
  <main id="recipe_container"
    class="container-xxl my-4 mx-auto px-4 px-md-5 bg-white rounded-5 py-5 shadow-lg mb-5 position-relative">
  </main>

  <!-- Reviews & Suggestions -->
  <section class="container-xxl my-4 mx-auto px-0 row">
    <!-- Reviews -->
    <div class="col-lg-9 pe-2">
      <h3>REVIEWS</h3>
      <div id="reviews_container" class="w-100 d-flex flex-column align-items-center">
        <div class="container-xxl mx-auto">
          <!-- Login to Review -->
          <div class="m-3 w-100 logged-out-only">
            <h4 class="text-center py-4">
              <span class="text-decoration-underline" style="cursor: pointer;" data-bs-toggle="modal"
                data-bs-target="#loginModal">Login</span> to Write a Review!
            </h4>
          </div>
        </div>
        <!-- Write a Review Form -->
        <div class="card m-3 p-3 rounded-5 shadow border-0 w-100 logged-in-only" style="max-width: 900px;">
          <div class="row">
            <div class="col-md-1">
              <div class="card-body">
                <div class="bg-primary rounded-5" style="width:fit-content">
                  <img src="../assets/img/anon.png" alt="Profile Picture">
                </div>
              </div>
            </div>
            <div class="col-md-11">
              <div class="card-body">
                <form action="recipe.html" name="review_form" onsubmit="return validateAndPublishReview(this)">
                  <div class="row pe-4">
                    <input name="content" id="review_content"
                      class="w-100 border-0 border-bottom border-2 border-black ps-1" type="text"
                      placeholder="Leave a review on this recipe..." onclick="showReviewForm()">
                  </div>
                  <div class="review-form-more | d-none">
                    <div class="row mt-4 mb-3">
                      <div class="col-md-4 d-flex flex-column ps-0">
                        <div class="d-flex align-items-center">
                          <label class="mb-0" for="review_taste">Taste:</label>
                          <input class="form-control m-0 border-0" type="number" name="taste" id="review_taste" min="1"
                            max="5" style="width: fit-content" onchange="voteTaste(this.value, true)" required>
                        </div>
                        <div class="review-taste-input | review-score" style="cursor:pointer"
                          onmouseover="voteTaste(event.target.getAttribute('data-value'), false)"
                          onclick="voteTasteAndLock(event.target.getAttribute('data-value'))">
                          <img class="tint-black" src="../assets/img/star.png" alt="Taste Score" data-value="1">
                          <img class="tint-black" src="../assets/img/star.png" alt="Taste Score" data-value="2">
                          <img class="tint-black" src="../assets/img/star.png" alt="Taste Score" data-value="3">
                          <img class="tint-black" src="../assets/img/star.png" alt="Taste Score" data-value="4">
                          <img class="tint-black" src="../assets/img/star.png" alt="Taste Score" data-value="5">
                        </div>
                      </div>
                      <div class="col-md-4 d-flex flex-column ps-0">
                        <div class="d-flex align-items-center">
                          <label class="mb-0" for="review_difficulty">Difficulty:</label>
                          <input class="form-control m-0 border-0" type="number" name="difficulty"
                            id="review_difficulty" min="1" max="5" style="width: fit-content"
                            onchange="voteDifficulty(this.value, true)" required>
                        </div>
                        <div class="review-difficulty-input | review-score" style="cursor:pointer"
                          onmouseover="voteDifficulty(event.target.getAttribute('data-value'), false)"
                          onclick="voteDifficultyAndLock(event.target.getAttribute('data-value'))">
                          <img src="../assets/img/chef.png" alt="Difficulty Score" data-value="1">
                          <img src="../assets/img/chef.png" alt="Difficulty Score" data-value="2">
                          <img src="../assets/img/chef.png" alt="Difficulty Score" data-value="3">
                          <img src="../assets/img/chef.png" alt="Difficulty Score" data-value="4">
                          <img src="../assets/img/chef.png" alt="Difficulty Score" data-value="5">
                        </div>
                      </div>
                      <div class="col-md-4 d-flex flex-column ps-0">
                        <label class="mb-0" for="preparation_date">Preparation Date</label>
                        <input class="form-control border border-2 border-black fs-5" type="date" name="date"
                          id="preparation_date" required>
                      </div>
                    </div>
                    <input class="keep-param" type="hidden" name="id" value="">
                    <div class="d-flex justify-content-end gap-3">
                      <button class="btn btn-outline-secondary" type="button"
                        onclick="closeReviewForm()">Cancel</button>
                      <input class="btn btn-primary border-0" type="submit" value="Publish">
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- Review Card -->
      </div>
    </div>
    <!-- Suggestions -->
    <div id="suggested_recipes"
      class="col-lg-3 d-flex flex-column gap-3 px-2 ps-lg-4 pe-lg-0 border-start border-black border-opacity-25">
      <h3>Also check out...</h3>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-top border-black border-opacity-25">
    <div class="container-xxl d-flex flex-column flex-md-row py-5 mx-auto px-3 px-md-5 justify-content-between">
      <!-- Logo -->
      <div>
        <a class="logo | d-flex align-items-baseline gap-1" href="index.html">
          <img class="tint-primary" src="../assets/img/chef.png" alt="PGRC Logo">
          <h1 class="h-0 text-primary">PGRC</h1>
        </a>
      </div>
      <!-- Demo Buttons -->
      <div>
        <ul
          class="list-group list-unstyled list-group-horizontal-md justify-content-center align-items-center d-flex gap-2 mt-2 mt-md-0">
          <li>
            <button class="switch-font | btn btn-light border border-black border-2 fs-4 px-3 py-1 rounded-4"
              onclick="switchFonts()" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Switch Font">
              Aa
            </button>
          </li>
          <li>
            <button class="btn btn-outline-secondary fs-4" onclick="clearStorage(); location.reload();">
              Reset Data
            </button>
          </li>
          <li>
            <button class="btn btn-outline-secondary fs-4" onclick="loadDemoData();">
              Load Demo Data
            </button>
          </li>
        </ul>
      </div>
    </div>
    </div>
  </footer>

  <!-- Modals -->

  <!-- Login Modal -->
  <modal class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="Modal For Login" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3 rounded-5">
        <div class="modal-header border-0 row align-items-baseline">
          <div class="line | col-3 bg-primary rounded-5 ms-1 d-none d-md-block"></div>
          <h1 class="col-md-3 modal-title fs-4 text-center" id="exampleModalLabel">LOG IN</h1>
          <div class="line | col bg-primary rounded-5 me-3 d-none d-md-block"></div>
          <button type="button" class="col-1 btn-close mb-auto" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body py-1">
          <div class="invalid-credentials | d-none text-center text-danger fs-6 mt-2">
            <p>Credentials are wrong! Try again</p>
          </div>
          <form method="GET" action="#" onsubmit="return checkCredentialsAndLogin(this)">
            <div class="col-12">
              <div class="d-flex flex-column mt-2">
                <label class="fs-5 text-dark" for="login_email">Email</label>
                <input class="form-control rounded-2 p-2 border-2" type="email" name="email" id="login_email"
                  autocomplete="username" required>
              </div>
              <div class="d-flex flex-column my-3 position-relative">
                <label class="fs-5 text-dark" for="login_password">Password</label>
                <img style="cursor: pointer;" class="position-absolute top-0 end-0" src="../assets/img/view.png"
                  alt="Show Password" width="25" onclick="toggleShowPassword()">
                <input class="toggle-visibility | form-control rounded-2 p-2 border-2" type="password" name="password"
                  id="login_password" autocomplete="current-password" required>
              </div>
              <input class="keep-param" type="hidden" name="id" value="">
              <button type="submit" class="w-100 btn btn-primary fs-5 mt-4 mb-2">Log In</button>
            </div>
          </form>
        </div>
        <div class="modal-footer d-block border-0 text-center pt-0">
          <p class="text-secondary mt-0 pt-0">Don't have an account? <a class="text-decoration-underline"
              href="signup.html">Register
              here</a></p>
        </div>
      </div>
    </div>
  </modal>

  <!-- Save Recipe Modal -->
  <modal class="modal fade" id="saveRecipeModal" tabindex="-1" aria-labelledby="Modal to Save Recipe"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3 rounded-5">
        <div class="modal-header border-0 row align-items-baseline">
          <div class="line | col-1 bg-primary col rounded-5 ms-1 d-none d-md-block"></div>
          <h1 class="col-md-6 modal-title fs-4 text-center" id="exampleModalLabel">READY TO SAVE?</h1>
          <div class="line | col bg-primary col rounded-5 me-3 d-none d-md-block"></div>
          <button type="button" class="col-1 btn-close mb-auto" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body py-1">
          <div class="invalid-credentials | d-none text-center text-danger fs-6 mt-2">
            <p>Credentials are wrong! Try again</p>
          </div>
          <form method="GET" action="index.html" onsubmit="return saveRecipe(this)">
            <div class="col-12">
              <div class="card-text py-2 px-1 mb-1 position-relative">
                <h5 class="text-black fs-6">Do you wanto to leave a note for <span
                    class="modal-recipe-label | text-primary">Recipe Name</span>?</h5>
                <textarea class="editable | w-100 rounded-5 border-2 ps-3 pe-5 py-2" id="note" name="note"
                  rows="4"></textarea>
                <input class="d-none" type="text" id="recipe_id" name="recipe_id">
              </div>
              <button type="submit" class="w-100 btn btn-primary fs-5 mt-3 mb-2" data-bs-dismiss="modal"
                aria-label="Close">Save</button>
            </div>
          </form>
        </div>
        <div class="modal-footer d-block border-0 text-center pt-0">
          <p class="text-secondary mt-0 pt-0">Saved recipes appear in your Cookbook!</p>
        </div>
      </div>
    </div>
  </modal>

  <!-- Delete Review Modal -->
  <modal class="modal fade" id="deleteReviewModal" tabindex="-1" aria-labelledby="Modal to Delete Review"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3 rounded-5">
        <div class="modal-header border-0 row align-items-baseline">
          <div class="line | col-1 bg-primary rounded-5 ms-1 d-none d-md-block"></div>
          <h1 class="col-6 modal-title fs-4 text-center" id="exampleModalLabel">ARE YOU SURE?</h1>
          <div class="line | col bg-primary rounded-5 me-3 d-none d-md-block"></div>
          <button type="button" class="col-1 btn-close mb-auto" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-4 pb-1 fs-5 text-black">
          <p>Do you really want to delete your review about <span class="modal-recipe-label | text-primary">Recipe
              Name</span></span>?</p>
          <div class="d-flex justify-content-center gap-3 mx-3">
            <button type="button" class="w-100 btn btn-outline-secondary fs-5 mt-3 mb-2">Cancel</button>
            <button type="button" class="delete-review | w-100 btn btn-primary fs-5 mt-3 mb-2"
              onclick="deleteReview(this)" data-bs-dismiss="modal" aria-label="Close">Delete</button>
          </div>
          <p class="fs-6 text-danger text-center">Mind that this operation is irreversibile</p>
        </div>
      </div>
    </div>
  </modal>

  <!-- Templates -->

  <!-- Recipe-->
  <template id="recipe">
    <div>
      <!-- Recipe Preview -->
      <div class="row align-items-end gap-4">
        <div class="col-lg">
          <!-- Stats -->
          <div class="recipe-card d-lg-block d-flex flex-column align-items-center" data-template-type="attribute"
            data-template-attribute="data-favourite" data-template-value="favourite" data-favourite="false">
            <div data-template-type="attribute" data-template-attribute="data-bs-recipe" data-template-value="name"
              class="recipe-save ms-0" data-bs-toggle="modal" data-bs-target="#saveRecipeModal"
              data-bs-recipe="Lamb Pilaf (Plov)" style="position: relative;">
              <div class="w-100 h-100" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Save Recipe">
              </div>
            </div>
            <div class="row">
              <div class="col flex-grow-0">
                <img width="24" src="../assets/img/star.png" alt="Taste Score">
              </div>
              <div class="col">
                <h4>Taste: <span class="ms-1" data-template-type="content" data-template-value="taste">0.0</span>/5</h4>
              </div>
            </div>
            <div class="row">
              <div class="col flex-grow-0">
                <img width="24" class="tint-danger" src="../assets/img/chef.png" alt="Difficulty Score">
              </div>
              <div class="col">
                <h4>Difficulty: <span class="ms-1" data-template-type="content"
                    data-template-value="difficulty">0.0</span>/5</h4>
              </div>
            </div>
            <div class="row">
              <div class="col flex-grow-0">
                <img width="24" src="../assets/img/comment.png" alt="Number of Reviews">
              </div>
              <div class="col">
                <h4>Reviews: <span class="ms-1" data-template-type="content" data-template-value="reviews">0</span></h4>
              </div>
            </div>
          </div>
          <!-- Title & Tags -->
          <div>
            <h1 class="display-2 my-3 d-flex align-items-end" data-template-type="content" data-template-value="name"
              style="min-height: 2em">
              Recipe Name Goes Here</h1>
            <div>
              <a data-template-type="attribute" data-template-attribute="href" data-template-value="area_href"
                class="btn btn-success my-1 fs-5" href="#">
                <span data-template-type="content" data-template-value="area">Area</span>
              </a>
              <a data-template-type="attribute" data-template-attribute="href" data-template-value="category_href"
                class="btn btn-info my-1 fs-5" href="#">
                <span data-template-type="content" data-template-value="category">Category</span>
              </a>
            </div>
          </div>
        </div>
        <div class="col-lg order-first order-lg-0">
          <!-- Image -->
          <img id="recipe_image" class="recipe-image | rounded-5" data-template-type="attribute"
            data-template-attribute="src" data-template-value="image"
            src="https://www.themealdb.com/images/media/meals/xrptpq1483909204.jpg">
        </div>
      </div>
      <!-- Recipe Details -->
      <div class="row gap-4 mt-5 border-top border-black border-opacity-25">
        <!-- Recipe Ingredients -->
        <div class="col-lg-4 border-lg-end border-black border-opacity-25 pt-5">
          <h3 class="mb-3">INGREDIENTS</h3>
          <div id="ingredients_container" data-template-type="element" data-template-value="ingredients">
            <!-- Ingredients -->
          </div>
        </div>
        <!-- Recipe Instructions -->
        <div class="col-md pt-5">
          <div class="mt-5">
            <p class="fs-5 text-secondary mb-1">INSTRUCTIONS</p>
            <p class="fs-5" data-template-type="element" data-template-value="instructions"
              style="white-space: normal;">Stone and chop the dates quite small, put them in a bowl, then pour the
              boiling water
              over.
            </p>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- Ingredient Item -->
  <template id="ingredient">
    <div class="row justify-content-center align-items-center">
      <img data-template-type="attribute" data-template-attribute="src" data-template-value="image" class="col-2"
        src="https://www.themealdb.com/images/ingredients/Medjool%20dates.png">
      <div class="col">
        <a data-template-type="attribute" data-template-attribute="href" data-template-value="href" href="#"
          style="height: 2em">
          <p data-template-type="content" data-template-value="name" class="fs-5 text-decoration-underline px-0 mb-0">
            Ingredient Name</p>
        </a>
      </div>
      <p data-template-type="content" data-template-value="measure" class="col-4 text-secondary fs-5 px-0 mb-0">255g</p>
    </div>
  </template>

  <!-- Review Card -->
  <template id="review_card">
    <div class="review-card | card m-3 p-3 rounded-5 shadow border-0 w-100" style="max-width: 900px;"
      data-template-type="attribute" data-template-attribute="data-my-review" data-template-value="my_review"
      data-my-review="false">
      <div class="row">
        <div class="col-md-3">
          <div class="card-body">
            <!-- Username & Picture -->
            <div class="d-flex align-items-center gap-2">
              <div class="bg-primary rounded-5" style="width:fit-content">
                <img src="../assets/img/anon.png" alt="Profile Picture">
              </div>
              <p data-template-type="content" data-template-value="author" class="card-text">Username</p>
            </div>
            <!-- Taste -->
            <div data-template-type="element" data-template-value="taste">
            </div>
            <!-- Difficulty -->
            <div data-template-type="element" data-template-value="difficulty">
            </div>
          </div>
        </div>
        <div class="col-md-9">
          <div class="card-body">
            <!-- Review Date -->
            <p class="text-secondary mb-2">
              <span data-template-type="content" data-template-value="date">mm-dd-yyyy</span>
            </p>
            <!-- Review Content -->
            <p data-template-type="content" data-template-value="content" class="card-text fs-5">Lorem ipsum dolor sit
              amet
              consectetur adipisicing elit. Sunt quisquam ratione
              iure laboriosam ipsam, nesciunt pariatur ullam eius saepe blanditiis.
            </p>
          </div>
        </div>
        <!-- Review Metadata -->
        <span data-template-type="attribute" data-template-attribute="data-timestamp" data-template-value="timestamp"
          class="d-none"></span>
        <span data-template-type="attribute" data-template-attribute="data-recipe_id" data-template-value="recipe_id"
          class="d-none"></span>
        <span data-template-type="attribute" data-template-attribute="data-email" data-template-value="email"
          class="d-none"></span>
      </div>
      <div class="review-delete" data-template-type="attribute" data-template-attribute="data-bs-recipe"
        data-template-value="recipe" data-bs-toggle="modal" data-bs-target="#deleteReviewModal"
        data-bs-recipe="Recipe Name">
        <div class="w-100 h-100" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete Review">
        </div>
      </div>
    </div>
  </template>

  <!-- Taste Score -->
  <template id="taste_score">
    <div>
      <p class="card-text my-0 pt-3">
        Taste:
      </p>
      <div class="review-score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="1"
          src="../assets/img/star.png" alt="Taste Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="2"
          src="../assets/img/star.png" alt="Taste Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="3"
          src="../assets/img/star.png" alt="Taste Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="4"
          src="../assets/img/star.png" alt="Taste Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="5"
          src="../assets/img/star.png" alt="Taste Score">
      </div>
    </div>
  </template>

  <!-- Difficulty Score -->
  <template id="difficulty_score">
    <div>
      <p class="card-text my-0 pt-3">
        Difficulty:
      </p>
      <div class="review-score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="1"
          src="../assets/img/chef.png" alt="Difficulty Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="2"
          src="../assets/img/chef.png" alt="Difficulty Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="3"
          src="../assets/img/chef.png" alt="Difficulty Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="4"
          src="../assets/img/chef.png" alt="Difficulty Score">
        <img data-template-type="attribute" data-template-attribute="class" data-template-value="5"
          src="../assets/img/chef.png" alt="Difficulty Score">
      </div>
    </div>
  </template>

  <!-- Recipe Card -->
  <template id="recipe-card">
    <div class="recipe-card | rounded-5 overflow-hidden shadow-sm w-100 scale-on-hover" data-template-type="attribute"
      data-template-attribute="data-favourite" data-template-value="favourite" data-favourite="false">
      <a data-template-type="attribute" data-template-attribute="href" data-template-value="href"
        class="card border-0 position-relative h-100" href="recipe.html?id=00000">
        <img data-template-type="attribute" data-template-attribute="src" data-template-value="image"
          src="https://www.themealdb.com/images/media/meals/kos9av1699014767.jpg" class="recipe-image | card-img-top">
        <div class="card-body">
          <div class="card-text row gap-2 justify-content-center mb-2">
            <div class="col-3 d-flex align-items-center gap-2">
              <img width="20" src="../assets/img/star.png" alt="Taste Score">
              <span data-template-type="content" data-template-value="taste">0.0</span>
            </div>
            <div class="col-3 d-flex align-items-center gap-2">
              <img class="tint-danger" width="20" src="../assets/img/chef.png" alt="Difficulty Score">
              <span data-template-type="content" data-template-value="difficulty">0.0</span>
            </div>
            <div class="col-3 d-flex align-items-center gap-2">
              <img width="20" src="../assets/img/comment.png" alt="Number of Reviews">
              <span data-template-type="content" data-template-value="reviews">0</span>
            </div>
          </div>
          <hr>
          <div class="py-2 d-flex flex-column justify-content-end">
            <h5 data-template-type="content" data-template-value="area"
              class="card-title text-primary text-uppercase fs-5 d-none">Area Cuisine</h5>
            <h4 data-template-type="content" data-template-value="name" class="card-title fs-3 text-center px-2">Recipe
              Name</h4>
          </div>
        </div>
      </a>
      <div data-template-type="attribute" data-template-attribute="data-bs-recipe" data-template-value="name"
        class="recipe-save" data-bs-toggle="modal" data-bs-target="#saveRecipeModal" data-bs-recipe="Lamb Pilaf (Plov)">
        <div class="w-100 h-100" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Save Recipe">
        </div>
      </div>
    </div>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
    crossorigin="anonymous"></script>
  <script src="../assets/js/api.js"></script>
  <script src="../assets/js/storage.js"></script>
  <script src="../assets/js/form-control.js"></script>
  <script src="../assets/js/utils.js"></script>
  <script src="../assets/js/test-data.js"></script>
  <script type="module">

    //Page Load
    let id = getURLParam("id");
    let recipe_data = await getDetailsById(id);
    document.review_form.date.valueAsDate = new Date(); //Load today's date as default for review form
    fillRecipeCard();
    placeReviews();
    placeSuggestedRecipes(Math.floor(document.querySelector("#reviews_container").clientHeight / 400)); //Number is calculated basing on the number of reviews

    //Fill Recipe Card
    async function fillRecipeCard() {
      let recipe_container = document.querySelector("#recipe_container");
      document.querySelector("head>title").textContent += recipe_data.strMeal; //Browser Tab Title

      //Extract Ingredients
      let ingredients_data = extractIngredients(recipe_data);
      let ingredients_elements = ingredients_data.map((ingr) => buildDynamicElement("ingredient", {
        name: ingr.name,
        measure: ingr.measure,
        image: "https://www.themealdb.com/images/ingredients/" + ingr.name + "-Small.png",
        href: "search.html?ingredient=" + ingr.name,
      })).map(getElementHTML);

      //Build and Place Recipe
      let recipe_stats = getRecipeReviewStats(id);
      let recipe_element = buildDynamicElement("recipe", {
        name: recipe_data.strMeal,
        category: recipe_data.strCategory,
        category_href: "search.html?category=" + recipe_data.strCategory,
        area: recipe_data.strArea,
        area_href: "search.html?area=" + recipe_data.strArea,
        instructions: recipe_data.strInstructions.replaceAll("\r\n", "<br>"),
        image: recipe_data.strMealThumb,
        ingredients: ingredients_elements.join(''),
        favourite: isInCookbook(recipe_data.idMeal),
        difficulty: recipe_stats.difficulty,
        taste: recipe_stats.taste,
        reviews: recipe_stats.reviews,
      });
      recipe_container.appendChild(recipe_element);

      //To keep the parameter in URL when page is reloaded after login form is submitted
      let keep_param_on_login = document.querySelectorAll("input.keep-param");
      keep_param_on_login.forEach((el) => el.value = id);
    }

    //Add Reviews to the Page, return number of reviews placed
    function placeReviews() {
      //Get Reviews
      let reviews = getFromStorage("reviews")[id];
      let reviews_container = document.querySelector("#reviews_container");

      if (reviews) {
        //Sort Reviews
        reviews = Array.from(reviews).sort((r1, r2) => {
          return r2.timestamp - r1.timestamp;
        });

        //Build and Place Reviews
        reviews.forEach((review) => {
          let taste_template_data = {};
          let difficulty_template_data = {};
          for (let i = 1; i <= 5; i++) {
            if (review.taste < i)
              taste_template_data[i] = "tint-black";
            if (review.difficulty >= i)
              difficulty_template_data[i] = "tint-primary";
          }

          reviews_container.appendChild(buildDynamicElement("review_card", {
            my_review: (review.author == getFromStorage("current_user")) ? "true" : "false",
            author: (getUserByEmail(review.author)) ? getUserByEmail(review.author).username : "Anonymous",
            email: review.author,
            date: new Date(review.timestamp).toDateString(),
            timestamp: review.timestamp,
            content: review.content,
            recipe: recipe_data.strMeal,
            recipe_id: recipe_data.idMeal,
            taste: getElementHTML(buildDynamicElement("taste_score", taste_template_data)),
            difficulty: getElementHTML(buildDynamicElement("difficulty_score", difficulty_template_data)),
          }));
        });
      }
      return reviews ? reviews.length : 0;
    }

    //Place N suggested recipe cards. They are picked from the Storage
    function placeSuggestedRecipes(n) {
      let recipes = getFromStorage("random_recipes").recipes;
      if (!recipes)
        recipes = getFromStorage("suggested_recipes");
      if (!recipes)
        return; //There's no recipes to suggest
      recipes = shuffle(recipes);
      let container = document.querySelector("#suggested_recipes");
      for (let i = 0; i < n; i++) {
        let recipe = recipes[i];
        let recipe_stats = getRecipeReviewStats(recipe.id);
        container.appendChild(buildDynamicElement("recipe-card", {
          href: "recipe.html?id=" + recipe.id,
          image: recipe.image,
          difficulty: recipe_stats.difficulty,
          taste: recipe_stats.taste,
          reviews: recipe_stats.reviews,
          area: recipe.area + " Cuisine",
          name: recipe.name,
          favourite: isInCookbook(recipe.id),
        }));
      }
    }


  </script>
</body>

</html>